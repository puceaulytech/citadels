


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > BulkRunner</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.github.the10xdevs.citadels.bulk</a>
</div>

<h1>Coverage Summary for Class: BulkRunner (com.github.the10xdevs.citadels.bulk)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">BulkRunner</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/67)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.github.the10xdevs.citadels.bulk;
&nbsp;
&nbsp;import com.github.the10xdevs.citadels.gamestate.Game;
&nbsp;import com.github.the10xdevs.citadels.gamestate.GameBuilder;
&nbsp;import com.github.the10xdevs.citadels.gamestate.Leaderboard;
&nbsp;import com.github.the10xdevs.citadels.interaction.behaviors.Behavior;
&nbsp;import com.github.the10xdevs.citadels.logging.VoidLogger;
&nbsp;import com.opencsv.CSVReader;
&nbsp;import com.opencsv.CSVWriter;
&nbsp;import com.opencsv.exceptions.CsvException;
&nbsp;import dnl.utils.text.table.TextTable;
&nbsp;
&nbsp;import java.io.File;
&nbsp;import java.io.FileReader;
&nbsp;import java.io.FileWriter;
&nbsp;import java.io.IOException;
&nbsp;import java.nio.file.Path;
&nbsp;import java.nio.file.Paths;
&nbsp;import java.util.*;
&nbsp;
&nbsp;public class BulkRunner {
<b class="nc">&nbsp;    private final Map&lt;String, BulkResult&gt; scores = new HashMap&lt;&gt;();</b>
&nbsp;    private final List&lt;Behavior&gt; behaviors;
<b class="nc">&nbsp;    private final String[] headers = {&quot;Behavior&quot;, &quot;Wins&quot;, &quot;Loses&quot;, &quot;%&quot;, &quot;Average score&quot;};</b>
&nbsp;    private int iterations;
&nbsp;
<b class="nc">&nbsp;    public BulkRunner(int iterations, List&lt;Behavior&gt; behaviors) {</b>
<b class="nc">&nbsp;        this.iterations = iterations;</b>
<b class="nc">&nbsp;        this.behaviors = behaviors;</b>
&nbsp;
<b class="nc">&nbsp;        for (Behavior b : behaviors) {</b>
<b class="nc">&nbsp;            this.scores.put(b.getName(), new BulkResult());</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    public void run() {
<b class="nc">&nbsp;        for (int i = 0; i &lt; iterations; i++) {</b>
<b class="nc">&nbsp;            GameBuilder gameBuilder = GameBuilder.create()</b>
<b class="nc">&nbsp;                    .withLogger(new VoidLogger());</b>
&nbsp;
<b class="nc">&nbsp;            for (Behavior behavior : this.behaviors) {</b>
<b class="nc">&nbsp;                gameBuilder.addBehavior(behavior);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;
<b class="nc">&nbsp;            Game game = gameBuilder.build();</b>
&nbsp;
<b class="nc">&nbsp;            Leaderboard leaderboard = game.start();</b>
&nbsp;
<b class="nc">&nbsp;            for (int j = 0; j &lt; leaderboard.getEntries().size(); j++) {</b>
<b class="nc">&nbsp;                Leaderboard.Entry entry = leaderboard.getEntries().get(j);</b>
<b class="nc">&nbsp;                BulkResult bulkRunnerResult = this.scores.get(entry.getPlayer().getBehavior().getName());</b>
&nbsp;
<b class="nc">&nbsp;                if (j == 0) {</b>
<b class="nc">&nbsp;                    bulkRunnerResult.addWin();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    bulkRunnerResult.addLoss();</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                bulkRunnerResult.incrementAverageScore((double) entry.getScore() / iterations);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void printStats() {
<b class="nc">&nbsp;        String[][] data = this.getRawStats();</b>
&nbsp;
<b class="nc">&nbsp;        TextTable tt = new TextTable(headers, data);</b>
<b class="nc">&nbsp;        tt.printTable();</b>
&nbsp;    }
&nbsp;
&nbsp;    private String[][] getRawStats() {
<b class="nc">&nbsp;        String[][] data = new String[this.scores.size()][this.headers.length];</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;Map.Entry&lt;String, BulkResult&gt;&gt; sortedEntries = this.scores.entrySet()</b>
<b class="nc">&nbsp;                .stream()</b>
<b class="nc">&nbsp;                .sorted(Comparator.comparingInt((Map.Entry&lt;String, BulkResult&gt; e) -&gt; e.getValue().getWins()).reversed())</b>
<b class="nc">&nbsp;                .toList();</b>
&nbsp;
<b class="nc">&nbsp;        int i = 0;</b>
<b class="nc">&nbsp;        for (Map.Entry&lt;String, BulkResult&gt; entry : sortedEntries) {</b>
<b class="nc">&nbsp;            String behavior = entry.getKey();</b>
<b class="nc">&nbsp;            BulkResult bulkResult = entry.getValue();</b>
&nbsp;
<b class="nc">&nbsp;            data[i][0] = behavior;</b>
<b class="nc">&nbsp;            data[i][1] = String.valueOf(bulkResult.getWins());</b>
<b class="nc">&nbsp;            data[i][2] = String.valueOf(bulkResult.getLoses());</b>
<b class="nc">&nbsp;            data[i][3] = String.valueOf(bulkResult.getWinPercentage(this.iterations));</b>
<b class="nc">&nbsp;            data[i][4] = String.format(&quot;%.2f&quot;, bulkResult.getAverageScore());</b>
<b class="nc">&nbsp;            i++;</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return data;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void mergeExistingCSV(File csvFile) throws IOException, CsvException {
<b class="nc">&nbsp;        try (CSVReader reader = new CSVReader(new FileReader(csvFile))) {</b>
<b class="nc">&nbsp;            List&lt;String[]&gt; allRows = reader.readAll();</b>
<b class="nc">&nbsp;            List&lt;String[]&gt; dataRows = allRows.subList(1, allRows.size());</b>
&nbsp;
<b class="nc">&nbsp;            int previousGameCount = Integer.parseInt(dataRows.get(0)[1]) + Integer.parseInt(dataRows.get(0)[2]);</b>
<b class="nc">&nbsp;            this.iterations += previousGameCount;</b>
&nbsp;
<b class="nc">&nbsp;            for (String[] dataRow : dataRows) {</b>
<b class="nc">&nbsp;                String behaviorName = dataRow[0];</b>
<b class="nc">&nbsp;                BulkResult bulkResult = this.scores.get(behaviorName);</b>
&nbsp;
<b class="nc">&nbsp;                bulkResult.addWin(Integer.parseInt(dataRow[1]));</b>
<b class="nc">&nbsp;                bulkResult.addLoss(Integer.parseInt(dataRow[2]));</b>
<b class="nc">&nbsp;                bulkResult.setAverageScore((bulkResult.getAverageScore() + Double.parseDouble(dataRow[4])) / 2);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeToCSV() throws CsvException, IOException {
<b class="nc">&nbsp;        Path filePath = Paths.get(&quot;stats&quot;, &quot;gamestats.csv&quot;);</b>
<b class="nc">&nbsp;        File csvFile = filePath.toFile();</b>
&nbsp;
<b class="nc">&nbsp;        if (csvFile.exists() &amp;&amp; !csvFile.isDirectory()) {</b>
<b class="nc">&nbsp;            this.mergeExistingCSV(csvFile);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            File statDir = Paths.get(&quot;stats&quot;).toFile();</b>
<b class="nc">&nbsp;            if (!statDir.exists() &amp;&amp; !statDir.mkdir()) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        CSVWriter writer = new CSVWriter(new FileWriter(csvFile));</b>
<b class="nc">&nbsp;        String[][] data = this.getRawStats();</b>
&nbsp;
<b class="nc">&nbsp;        writer.writeNext(this.headers, false);</b>
<b class="nc">&nbsp;        writer.writeAll(Arrays.stream(data).toList(), false);</b>
&nbsp;
<b class="nc">&nbsp;        writer.close();</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-02-07 10:35</div>
</div>
</body>
</html>
